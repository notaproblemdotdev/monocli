---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/monocli/models.py
  - tests/test_models.py
autonomous: true
must_haves:
  truths:
    - PullRequest model validates GitHub PR data (number, title, status, author, url)
    - MergeRequest model validates GitLab MR data (iid, title, state, author, web_url)
    - Issue model validates GitHub Issue data
    - WorkItem model validates Jira issue data (key, summary, status, priority)
    - All models have comprehensive test coverage with valid and invalid cases
    - Models use Pydantic v2 Field validation with clear error messages
  artifacts:
    - path: src/monocli/models.py
      provides: "Pydantic models for all data structures"
      exports: ["PullRequest", "MergeRequest", "Issue", "WorkItem", "WorkItemStatus", "Priority"]
      min_lines: 100
    - path: tests/test_models.py
      provides: "Unit tests for all Pydantic models"
      min_lines: 150
  key_links:
    - from: tests/test_models.py
      to: src/monocli/models.py
      via: "import and test"
      pattern: "from monocli.models import"
---

<objective>
Create Pydantic v2 models for all platform data structures: PullRequest (GitHub), MergeRequest (GitLab), Issue (GitHub), and WorkItem (Jira). Include comprehensive unit tests with valid and invalid input cases.

Purpose: Establish type-safe data contracts that validate CLI outputs from gh, glab, and acli.
Output: Validated Pydantic models with 100% test coverage for parsing and validation logic.
</objective>

<execution_context>
@/Users/pg/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/REQUIREMENTS.md (DATA-03, DATA-04, DATA-05, DATA-06)

## Requirements Covered
- DATA-03: All CLI responses parsed and validated with Pydantic
- DATA-04: GitLab MRs include number, title, status, author, URL
- DATA-05: Jira work items include key, title, status, priority, URL
- DATA-06: Display format (Key + Title + Status + Priority)

## Model Requirements

### PullRequest (GitHub)
- number: int
- title: str
- state: str ("open", "closed", "merged")
- author: dict with login
- url: HttpUrl
- created_at: datetime

### MergeRequest (GitLab)
- iid: int (MR number)
- title: str
- state: str ("opened", "closed", "merged")
- author: dict with name/username
- web_url: HttpUrl
- created_at: datetime
- source_branch: str
- target_branch: str

### Issue (GitHub)
- number: int
- title: str
- state: str ("open", "closed")
- author: dict with login
- url: HttpUrl
- labels: list[str]

### WorkItem (Jira)
- key: str (e.g., "PROJ-123")
- summary: str (title)
- status: WorkItemStatus enum
- priority: Priority enum
- url: HttpUrl
- assignee: Optional[str]
</context>

<tasks>

<task type="auto">
  <name>Create Pydantic models for MR/PR data</name>
  <files>src/monocli/models.py</files>
  <action>
Create src/monocli/models.py with Pydantic v2 models:

1. Enums for status/priority:
   - `WorkItemStatus`: todo, in_progress, done, blocked
   - `Priority`: lowest, low, medium, high, highest

2. Base model `WorkItem` with common fields:
   - id: str (key/number as string for display)
   - title: str
   - status: str
   - url: HttpUrl
   - created_at: Optional[datetime]

3. Platform-specific models:
   - `PullRequest`: GitHub PR with number, title, state, author dict, html_url, draft bool
   - `MergeRequest`: GitLab MR with iid, title, state, author dict, web_url, source_branch, target_branch
   - `GitHubIssue`: GitHub issue with number, title, state, author dict, html_url, labels list
   - `JiraWorkItem`: Jira issue with key, summary, status dict, priority dict, self (url), assignee dict

4. Use Pydantic v2 Field for validation:
   - `Field(..., description="...")` for documentation
   - `Field(..., pattern=r"^\w+-\d+$")` for Jira key format
   - Use `HttpUrl` from pydantic for URL validation
   - Use `datetime` from datetime module, Pydantic handles ISO 8601 parsing

5. Add model_config = ConfigDict(strict=True, validate_assignment=True) for strict validation

6. Add helper methods:
   - `display_key() -> str`: Return formatted key for display
   - `display_status() -> str`: Return normalized status string
   - `is_open() -> bool`: Check if item is open/ongoing
  </action>
  <verify>
    - `uv run python -c "from monocli.models import PullRequest, MergeRequest, Issue, WorkItem; print('Models importable')"`
    - Models can be instantiated with sample data
    - Invalid data raises ValidationError
  </verify>
  <done>
    All Pydantic models defined with proper validation, enums, and helper methods
  </done>
</task>

<task type="auto">
  <name>Create comprehensive model tests</name>
  <files>tests/test_models.py</files>
  <action>
Create tests/test_models.py with comprehensive test coverage:

1. Import all models and pytest
2. Create fixtures for valid sample data:
   - `valid_pr_data()`: GitHub PR JSON sample
   - `valid_mr_data()`: GitLab MR JSON sample
   - `valid_issue_data()`: GitHub issue JSON sample
   - `valid_jira_data()`: Jira issue JSON sample

3. Test valid instantiation:
   - `test_pull_request_valid()`: Create PR from valid data
   - `test_merge_request_valid()`: Create MR from valid data
   - `test_github_issue_valid()`: Create issue from valid data
   - `test_jira_work_item_valid()`: Create Jira item from valid data

4. Test validation errors:
   - `test_pull_request_missing_required()`: Missing number/title
   - `test_merge_request_invalid_state()`: Invalid state value
   - `test_jira_work_item_invalid_key()`: Key without hyphen
   - `test_invalid_url()`: Malformed URL field
   - `test_invalid_datetime()`: Non-ISO datetime string

5. Test helper methods:
   - `test_display_key_formats()`: Verify display_key() output
   - `test_is_open_logic()`: Verify is_open() for various states

6. Use pytest.mark.parametrize for similar test cases

7. Run `uv run pytest tests/test_models.py -v` and verify all pass
  </action>
  <verify>
    - `uv run pytest tests/test_models.py -v` passes all tests
    - `uv run pytest --cov=src/monocli/models --cov-report=term-missing` shows high coverage
    - `uv run mypy src/monocli/models.py` passes type checking
  </verify>
  <done>
    All Pydantic models have passing unit tests with valid and invalid input coverage
  </done>
</task>

</tasks>

<verification>
- [ ] `uv run python -c "from monocli.models import *"` imports successfully
- [ ] Models can parse sample CLI output JSON structures
- [ ] Invalid data raises Pydantic ValidationError with clear messages
- [ ] `uv run pytest tests/test_models.py` passes (100% of tests)
- [ ] `uv run mypy src/monocli/models.py` passes with no errors
</verification>

<success_criteria>
1. PullRequest model validates GitHub PR structure (number, title, state, author, url)
2. MergeRequest model validates GitLab MR structure (iid, title, state, author, web_url)
3. Issue model validates GitHub Issue structure
4. WorkItem model validates Jira structure (key, summary, status, priority, url)
5. All models have unit tests with valid and invalid input cases
6. Tests pass with pytest, type checking passes with mypy
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
