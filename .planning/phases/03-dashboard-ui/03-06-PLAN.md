---
phase: 03-dashboard-ui
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - src/monocli/ui/main_screen.py
  - src/monocli/ui/sections.py
autonomous: true
gap_closure: true
must_haves:
  truths:
    - Dashboard shows 'Merge Requests' section header clearly above the two subsections
    - Loading spinners are centered both vertically and horizontally within their sections
    - MR subsections display with 'Assigned to me' on the left and 'Opened by me' on the right
  artifacts:
    - path: "src/monocli/ui/main_screen.py"
      provides: "Added Label widget for Merge Requests header"
      contains: "Label('Merge Requests', classes='section-label')"
    - path: "src/monocli/ui/sections.py"
      provides: "Fixed spinner CSS centering"
      contains: "height: 100%"
      contains: "content-align: center middle"
    - path: "src/monocli/ui/sections.py"
      provides: "Swapped MR subsection order"
      yields: "assigned_to_me_section before opened_by_me_section"
---

<objective>
Fix UI and layout issues identified in UAT testing: add missing "Merge Requests" section header, center loading spinners, and correct the MR subsection display order.

Purpose: These are minor cosmetic issues that improve visual clarity and user experience of the dashboard.
Output: Updated main_screen.py and sections.py with all three fixes applied.
</objective>

<execution_context>
@/Users/pg/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/pg/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/03-dashboard-ui/03-dashboard-ui-UAT.md
@src/monocli/ui/main_screen.py
@src/monocli/ui/sections.py

## Gap Context

This plan addresses 3 diagnosed gaps from UAT.md:

**Gap 1: Missing "Merge Requests" header (minor)**
- Truth: Dashboard shows 'Merge Requests' section label/header clearly above the two subsections
- Root cause: Missing Label widget in MainScreen.compose() - no 'Merge Requests' header is yielded before the MergeRequestContainer
- Fix: Add `Label('Merge Requests', classes='section-label')` before `self.mr_container = MergeRequestContainer()`
- CSS class `.section-label` already exists (lines 76-79) but is never used

**Gap 2: Spinners not centered (cosmetic)**
- Truth: Loading spinners are centered both vertically and horizontally within their sections
- Root cause: CSS missing content-align property and height should be 100% not auto
- Fix in BaseSection.DEFAULT_CSS (lines 63-67):
  - Change `height: auto` to `height: 100%`
  - Add `content-align: center middle`

**Gap 3: MR subsection order wrong (minor)**
- Truth: MR subsections display with 'Assigned to me' on the left (first) and 'Opened by me' on the right
- Root cause: MergeRequestContainer.compose() yields subsections in wrong order - opened first, assigned second
- Fix in MergeRequestContainer.compose() (lines 394-398): Swap lines 397 and 398 to yield `assigned_to_me_section` first
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add "Merge Requests" section header</name>
  <files>src/monocli/ui/main_screen.py</files>
  <action>
    In MainScreen.compose() method, add a Label widget before the MergeRequestContainer is yielded.
    
    Current code (lines 115-118):
    ```python
    # Top section: Merge Requests (with two subsections)
    with Vertical(id="mr-container"):
        self.mr_container = MergeRequestContainer()
        yield self.mr_container
    ```
    
    Change to:
    ```python
    # Top section: Merge Requests (with two subsections)
    with Vertical(id="mr-container"):
        yield Label("Merge Requests", classes="section-label")
        self.mr_container = MergeRequestContainer()
        yield self.mr_container
    ```
    
    Note: The CSS class `.section-label` already exists in DEFAULT_CSS (lines 76-79) with `text-style: bold; padding: 1 0 0 0;`
  </action>
  <verify>grep -n "Label.*Merge Requests" src/monocli/ui/main_screen.py | grep -q "section-label"</verify>
  <done>Label widget with 'Merge Requests' text and 'section-label' class exists in compose() method</done>
</task>

<task type="auto">
  <name>Task 2: Fix loading spinner CSS centering</name>
  <files>src/monocli/ui/sections.py</files>
  <action>
    Fix BaseSection.DEFAULT_CSS to center loading spinners properly.
    
    Current CSS (lines 63-67):
    ```python
    BaseSection #spinner-container {
        display: none;
        height: auto;
        width: 100%;
    }
    ```
    
    Change to:
    ```python
    BaseSection #spinner-container {
        display: none;
        height: 100%;
        width: 100%;
        content-align: center middle;
    }
    ```
    
    This ensures the spinner container takes full height and centers its content both vertically and horizontally.
  </action>
  <verify>grep -A4 "BaseSection #spinner-container" src/monocli/ui/sections.py | grep -q "content-align: center middle"</verify>
  <done>Spinner container CSS has height: 100% and content-align: center middle</done>
</task>

<task type="auto">
  <name>Task 3: Swap MR subsection order</name>
  <files>src/monocli/ui/sections.py</files>
  <action>
    In MergeRequestContainer.compose() method, swap the order of subsection yields so "Assigned to me" appears first (on the left in horizontal layout).
    
    Current code (lines 394-398):
    ```python
    def compose(self) -> ComposeResult:
        """Compose the container with two MR subsections."""
        with Vertical(id="mr-subsections"):
            yield self.opened_by_me_section
            yield self.assigned_to_me_section
    ```
    
    Change to:
    ```python
    def compose(self) -> ComposeResult:
        """Compose the container with two MR subsections."""
        with Vertical(id="mr-subsections"):
            yield self.assigned_to_me_section
            yield self.opened_by_me_section
    ```
    
    This makes "Assigned to me" appear on the left (first) when terminal is wide, matching user expectation.
  </action>
  <verify>
    # Verify the order: assigned should come before opened in compose()
    awk '/def compose.*MergeRequestContainer/,/^$/' src/monocli/ui/sections.py | grep -A5 "with Vertical" | grep -q "assigned_to_me_section" && \
    awk '/def compose.*MergeRequestContainer/,/^$/' src/monocli/ui/sections.py | grep -A5 "with Vertical" | head -4 | tail -2 | grep -q "assigned_to_me_section"
  </verify>
  <done>assigned_to_me_section is yielded before opened_by_me_section in compose()</done>
</task>

</tasks>

<verification>
Run these checks to verify all gaps are closed:

1. Verify "Merge Requests" header exists:
   ```bash
   grep -n "Merge Requests" src/monocli/ui/main_screen.py | head -5
   ```
   Should show Label with "Merge Requests" text.

2. Verify spinner CSS centering:
   ```bash
   grep -A5 "BaseSection #spinner-container" src/monocli/ui/sections.py
   ```
   Should show `height: 100%` and `content-align: center middle`.

3. Verify MR subsection order:
   ```bash
   grep -A5 "def compose.*MergeRequestContainer" src/monocli/ui/sections.py | grep -E "(assigned|opened)"
   ```
   Should show `assigned_to_me_section` first, then `opened_by_me_section`.

4. Run type checker:
   ```bash
   uv run ty src/monocli/ui/
   ```

5. Run linter:
   ```bash
   uv run ruff check src/monocli/ui/
   ```
</verification>

<success_criteria>
All 3 gaps from UAT.md are closed:
- [ ] Gap 1: Dashboard shows 'Merge Requests' section header above subsections
- [ ] Gap 2: Loading spinners are centered vertically and horizontally
- [ ] Gap 3: MR subsections display with 'Assigned to me' on left, 'Opened by me' on right
</success_criteria>

<output>
After completion, create `.planning/phases/03-dashboard-ui/03-06-SUMMARY.md`
</output>
